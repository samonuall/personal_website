# Personal website – working notes

- Repo shape: Next.js 14 app with app router (home `app/page.tsx`, projects grid `app/projects/page.tsx`; experience route removed—experience data now only feeds components like `StoryScroller`); UI pieces in `components`, static content in `data/*.ts`, styling via Tailwind CSS tokens in `app/globals.css`; dialogs/theme toggle rely on Radix + local state.
- Navigation behavior: project previews still push `#/id` and `app/projects/page.tsx` scrolls + clicks into the right dialog; experience hash routing was removed with the experience page, so keep any future sliders from pointing to `/experience`.
- Environment flag: `NEXT_PUBLIC_PRIVATE_MODE` disables opening `ExperienceCard` dialogs (renders “Click to learn more” text but blocks setOpen).
- Testing setup: Jest + ts-jest + Testing Library; tests live under `testing/**/*.test.tsx`; `jest.setup.js` mocks `next/image`; run via `npm test`.
- Useful commands: `npm run dev` to view site; `npm test` for unit tests; `sed -n '1,200p' <file>` for quick file reads; `ls <dir>` for structure.
- Styling/theme: CSS variables for light/dark defined in `app/globals.css`; `components/theme-toggle.tsx` toggles `light` class on `document.documentElement` using localStorage; default dark if no stored value.
- Type safety: React ref callbacks default to `HTMLElement | null`; when storing in typed arrays like `useRef<HTMLDivElement[]>`, annotate callbacks (e.g., `ref={(el: HTMLDivElement | null) => panelRefs.current[i] = el}`) to satisfy strict TS.
- Home page structure: hero + `StoryScroller` now followed by a “Systems & skills” section rendered via `SkillsSection` (`components/skills-section.tsx`, consumed in `app/page.tsx`). Skills are defined in the component as a typed array (supports custom icons from `/public/icons/*.svg` and gradient tones). Layout: intro copy on the left; grid of gradient cards on the right; no extra highlight cards.
- `StoryScroller` content: panels are built via a memoized `storyPanels` array combining data from `experiences` and `projects`. Cards support parallax offsets, intersection-based active index for side nav, and now render metric chips (label/value/hint/progress) with subtle pulse gradients instead of code snippets—keep motion guarded by `prefersReducedMotion`.
- Components: `components/project-row.tsx` is a reusable inline expander for `Project` data (no Radix). It supports controlled/uncontrolled `expanded` state, `onExpandedChange`/`onToggle` callbacks, and accepts `id`/`detailId` for hash routing. Collapsed view shows title + first tech tags; expanded area renders description, CTAs, and a media placeholder (customizable via `mediaSlot`). Expand button uses `aria-expanded` + `aria-controls` and keeps focus styles visible.
- Projects page now renders a vertical list of `ProjectRow` components (no Radix dialog). Hashes like `/projects#2` auto-expand and scroll into view via `expandedId` state + `rowRefs` lookup; `history.replaceState` keeps the hash in sync when toggling rows and clears it when collapsed.
- Styling alignment: `components/project-row.module.css` now owns the visual system for project rows (thin dividers, primary-accent focus/hover states, airy padding, aspect-ratio media frame to avoid overflow). `app/projects/projects.module.css` sets the vertical rhythm/dividers between rows—use these modules when adjusting spacing or adding variants to keep consistency with the home page palette and theme tokens. The projects hero title uses a pulsing primary→accent gradient animation with a `prefers-reduced-motion` escape hatch.
